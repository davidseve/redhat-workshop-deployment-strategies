<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Deployment Strategies with Argo CD and Argo Rollouts :: RHTE Workshop - Deployment Strategies with Argo CD and Argo Rollouts</title>
    <link rel="canonical" href="https://github.com/rhte2023-argo-rollouts/redhat-workshop-deployment-strategies/redhat-workshop-deployment-strategies/02-deployment-strategies.html">
    <link rel="prev" href="01-setup.html">
    <link rel="next" href="03-blue-green-deployment.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../_/css/site.css">
<link rel="icon" href="../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img
          src="../_/img/header_logo.png" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" href="https://github.com/rhte2023-argo-rollouts/redhat-workshop-deployment-strategies">RHTE Workshop - Deployment Strategies with Argo CD and Argo Rollouts</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Books</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">CheatSheets</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">CheatSheet A</a>
            <a class="navbar-item" href="#">CheatSheet B</a>
            <a class="navbar-item" href="#">CheatSheet C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Upcoming Events</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Event A</a>
            <a class="navbar-item" href="#">Event B</a>
            <a class="navbar-item" href="#">Event C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Tutorial A</a>
            <a class="navbar-item" href="#">Tutorial B</a>
            <a class="navbar-item" href="#">Tutorial C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="redhat-workshop-deployment-strategies" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html" class=" query-params-link">Workshop</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="01-setup.html">1. Environment Setup</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-setup.html#01-prerequisites">1.1 Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="01-setup.html#01-laboratory">1.2 Laboratory</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="01-setup.html#01-parameters">1.2.1 Parameters</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="01-setup.html#01-accessconsole">1.2.2 Access - OCP Console</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="01-setup.html#01-accesscli">1.2.3 Access - OCP CLI</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="01-setup.html#01-accessArgoCD">1.2.4 Access - ArgoCD dashboard</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="01-setup.html#01-cloneGit">1.2.5 Clone the GitOps repository</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="02-deployment-strategies.html">2. Deployment Strategies with Argo CD and Argo Rollouts</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#02-dstrategies-app">2.1 DStrategies App</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#02-deployment-strategies">2.2 Deployment Strategies</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#02-micro-arch">2.2.1 Microservices Architecture</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#02-cd">2.2.2 Continuous Delivery</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#02-pd">2.2.3 Progressive Delivery</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#02-argo-rollouts">2.2.4 Argo Rollouts</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="#02-bg">2.2.4.1 Blue/Green Deployment</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="#02-canary">2.2.4.2 Canary Deployment</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="03-blue-green-deployment.html">3. Blue/Green deployment strategy</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="04-canary-deployment.html">4. Canary deployment strategy</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Workshop</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Workshop</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Workshop</a></li>
    <li><a href="02-deployment-strategies.html">2. Deployment Strategies with Argo CD and Argo Rollouts</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/rhte2023-argo-rollouts/redhat-workshop-deployment-strategies/edit/master/documentation/modules/ROOT/pages/02-deployment-strategies.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Deployment Strategies with Argo CD and Argo Rollouts</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The following sections provide an overall vision about the application that will be used during this laboratory and the respective deployment strategies that will be reviewed during the workshop.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="02-dstrategies-app"><a class="anchor" href="#02-dstrategies-app"></a>DStrategies App</h2>
<div class="sectionbody">
<div class="paragraph">
<p>DStrategies App is a microservice based application that is composed by a backend microservice based on <a href="https://quarkus.io/">Quarkus</a> and a frontend microservice based on <a href="https://reactjs.org/">React</a>. The idea of this application is to be able to display the backend microservice caracteristics based on a HTTP request performed by the frontend.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/app_arch.png" alt="app arch">
</div>
</div>
<div class="paragraph">
<p>During this workshop, you will be able to deploy this application using different deployment strategies in order to gain knowledge and skills in managing microservice releases.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="02-deployment-strategies"><a class="anchor" href="#02-deployment-strategies"></a>Deployment Strategies Overview</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="02-micro-arch"><a class="anchor" href="#02-micro-arch"></a>Microservices Architecture</h3>
<div class="paragraph">
<p>The traditional approach to building applications has been focused on the monolith that is built as a single unit. To make any changes to the system, a developer must build and deploy an updated version of the whole application.</p>
</div>
<div class="paragraph">
<p><strong>Microservice Architectures</strong> help solve these issues and boost development and response. It&#8217;s one of the main factors of a <strong>Cloud Native development</strong>. Now, we have several applications that have dependencies on each others and also have other dependencies like brokers or databases.</p>
</div>
<div class="paragraph">
<p>Applications have their own life cycle, so we should be able to execute independent deployments. All the applications and dependencies will not change their version at the same time. Therefore, microservices enable your development team to roll out software solutions more quickly and better react to customer needs.</p>
</div>
</div>
<div class="sect2">
<h3 id="02-cd"><a class="anchor" href="#02-cd"></a>Continuous Delivery</h3>
<div class="paragraph">
<p>Continuous delivery is another important topic in Cloud Native practices. Often abbreviated as CD, is a set of practices in which <strong>code changes are automatically deployed into an acceptance environment</strong>. CD crucially includes procedures to ensure that software is adequately tested before deployment and provides a way to roll back changes if deemed necessary.</p>
</div>
<div class="paragraph">
<p>As an evolution of continuous develivery, there is another practice named <strong>Continuous Deployment</strong>. In this practice, the pipeline automatically and frequently pushes changes to production without waiting for a human to approve each deployment.</p>
</div>
</div>
<div class="sect2">
<h3 id="02-pd"><a class="anchor" href="#02-pd"></a>Progressive Delivery</h3>
<div class="paragraph">
<p>Progressive delivery is the process of releasing updates of a product in a controlled and gradual manner, thereby reducing the risk of the release, typically <strong>coupling automation and metric analysis</strong> to drive the automated promotion or rollback of the update.</p>
</div>
<div class="paragraph">
<p>It is often described as an evolution of continuous delivery, extending the speed benefits made in CI/CD to the deployment process. This is accomplished by limiting the exposure of the new version to a subset of users, observing and analyzing for correct behavior, then progressively increasing the exposure to a broader and wider audience while continuously verifying correctness.</p>
</div>
</div>
<div class="sect2">
<h3 id="02-argo-rollouts"><a class="anchor" href="#02-argo-rollouts"></a>Argo Rollouts</h3>
<div class="paragraph">
<p><a href="https://argoproj.github.io/argo-rollouts/">Argo Rollouts</a> is a Kubernetes controller and set of CRDs which provide advanced deployment capabilities such as blue-green, canary, canary analysis, experimentation, and progressive delivery features to Kubernetes.</p>
</div>
<div class="paragraph">
<p>The native Kubernetes Deployment Object supports the RollingUpdate strategy which provides a basic set of safety guarantees (readiness probes) during an update. In large scale high-volume production environments, a rolling update is often considered too risky of an update procedure since it provides no control over the blast radius, may rollout too aggressively, and provides no automated rollback upon failures.</p>
</div>
<div class="paragraph">
<p>For this reason, Argo Rollouts tries to implement the following controller features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Blue-Green update strategy</p>
</li>
<li>
<p>Canary update strategy</p>
</li>
<li>
<p>Fine-grained, weighted traffic shifting</p>
</li>
<li>
<p>Automated rollbacks and promotions</p>
</li>
<li>
<p>Manual judgment</p>
</li>
<li>
<p>Customizable metric queries and analysis of business KPIs</p>
</li>
<li>
<p>Ingress controller integration: NGINX, ALB</p>
</li>
<li>
<p>Service Mesh integration: Istio, Linkerd, SMI</p>
</li>
<li>
<p>Simultaneous usage of multiple providers: SMI + NGINX, Istio + ALB, etc.</p>
</li>
<li>
<p>Metric provider integration: Prometheus, Wavefront, Kayenta, Web, Kubernetes Jobs, Datadog, New Relic, Graphite, InfluxDB</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="02-bg"><a class="anchor" href="#02-bg"></a>Blue/Green Deployment</h4>
<div class="paragraph">
<p>A <strong>Blue-green deployment</strong> is a strategy for updating running computer systems with <strong>minimal downtime</strong>. The operator maintains two environments, dubbed blue and green. One serves production traffic (the version all users use), while the other is updated.</p>
</div>
<div class="paragraph">
<p>Only the old version of the application will receive production traffic. This allows the developers to run tests against the new version before switching the live traffic to the new version.</p>
</div>
<div class="paragraph">
<p>For instance, the old version is the blue environment, while the new version is the green environment. Once all the <strong>production traffic is fully transferred from blue to green</strong>, blue can be kept as-is for a possible rollback or be updated to become the template upon which the next update is made.</p>
</div>
<div class="paragraph">
<p><strong>Advantages</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Minimize downtime.</p>
</li>
<li>
<p>A quick way to roll back.</p>
</li>
<li>
<p>Smoke testing.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Disadvantages</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Doubling of total resources.</p>
</li>
<li>
<p>Backward compatibility.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the following example, we have two versions up and running, online and offline. As explained above, we can deploy a new version of the microservice in the green service ("offline") and perform <strong>smoke tests</strong> against it to ensure that the new version will perform correctly when real traffic begins to arrive to Green.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/blue-green.png" alt="Blue/Green">
</div>
</div>
<div class="paragraph">
<p>When a new version is ready for real users, we only have to modify the traffic flow to point to the new deployment (Green) as in the following image. There is minimal downtime and we can do a rapid rollback just by undoing the changes.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/blue-green-switch.png" alt="Blue/Green switch">
</div>
</div>
<div class="paragraph">
<p>As with great power comes great responsibility, you have to take the following into account:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>We need to <strong>double the total resources used</strong>: CPU, RAM, Persistent Storage, etc. We will see how to minimize this effect.</p>
</li>
<li>
<p>We have to be <strong>ready for a rapid rollback</strong>. In case of seeing any issue in the monitorization, we should be able to modify the service to point back to the first deployment.</p>
</li>
<li>
<p>We need to keep <strong>backward compatibility</strong>. If not, we would not be able to perform rollbacks.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="02-canary"><a class="anchor" href="#02-canary"></a>Canary Deployment</h4>
<div class="paragraph">
<p>A <strong>Canary deployment</strong> exposes a subset of users to the new version of the application while serving the rest of the traffic to the old version. Once the new version is verified to be correct based on metrics or some healthchecks, the new version can gradually replace the old version using Ingress controllers and service meshes such as NGINX and Istio (e.g. achieving very fine-grained traffic splitting, or splitting based on HTTP headers).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/canary1.png" alt="canary1">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/canary2.png" alt="canary2">
</div>
</div>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="01-setup.html" class="query-params-link">1. Environment Setup</a></span>
  <span class="next"><a href="03-blue-green-deployment.html" class="query-params-link">3. Blue/Green deployment strategy</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../_/js/vendor/clipboard.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
